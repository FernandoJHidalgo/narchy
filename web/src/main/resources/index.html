<html>
<head>

    <title>NARchy</title>

    <style type="text/css">
        @import url("terminal.css");
        @import url("spacegraph.dark.css");
        @import url("spacegraph.css");
    </style>
    <link rel="import" href="init.html">

    <style>

        #active {
            position: fixed; width: 100%;
        }

        #view {
            height: 100%;
        }


        #mainButtons {

        }
        #mainButtons div {
            margin: 0 !important;
            z-index: 20000;
        }

        .NARConsole {
            width: 100% !important;
            height: 100% !important;
        }

        #nalInput {
            position: fixed; bottom: 0; left: 0; width: 100%;
            height: 30px; opacity: 0.8;
            margin: 0;
            border: 0;
        }
        #nalInput .NALEditor {
            font-size: 30px;
        }

        .ui-dialog {
            opacity: 0.8 !important;
        }
        .simone-taskbar-horizontal.simone-taskbar-stick-top .simone-taskbar-window-buttons-container {
            padding-left: 80px; /* shift over so that the main buttons dont cover the left taskbar buttons */

        }

    </style>


</head>
<body>



    <div id="view" style="position: fixed; width: 100%; height: 100%"></div>



    <div class="taskbar">

    </div>

    <div id="mainButtons" style="cursor: crosshair;">
        <div class="ui dropdown icon orange button">
            <i class="warning sign icon"></i>
            <i class="dropdown icon"></i>
            <div class="menu">
                <div class="item" id="log">+ Log</div>
                <div class="item" id="timeline">+ Timeline</div>
                <div class="item">+ Status</div>
                <hr/>
                <div class="item">Load...</div>
                <div class="item">Save...</div>
                <hr/>
                <div class="item">Reset</div>
                <div class="item">Shutdown</div>
            </div>
        </div>
    </div>


    <!--<div class="ui grid">-->

        <!--<div class="four wide column">-->
            <!--<div class="ui segment" style="opacity: 0.2">-->
                <!--<h1>Emotion</h1>-->
                <!--<div id="emotion"></div>-->
            <!--</div>-->
        <!--</div>-->

    <!--</div>-->

    <!--<div id="menu"></div>-->

    <div id="narOutput">
    </div>





</body>



<script src="narchy.js"></script>

<script>
    "use strict";

    var terminal, viewing = undefined;

    function addView(v) {
        /*
         <div class="ui dropdown icon purple button" id="rootButton">
             <i class="bomb icon"></i>
             <i class="dropdown icon"></i>
            <div class="menu">
                <div class="item">
                    <i class="options icon"></i>
                    <select id="rootSelect">

         </select>

         <div id="rootOptions" class="ui segment">
         options..
         <!-- updated by change in rootSelect selector -->
         </div>

         <button class="right floated primary ui button" onclick="$('#rootButton .menu').hide()">OK</button>
         </div>
         </div>
         </div>
    */

        var dropDownIcon, dropDownMenu;

        var x = $('<div class="ui dropdown icon ' + v.color + ' button"/>').append(
             '<i class="' + v.icon + ' icon"></i>',
             dropDownIcon = $('<i class="dropdown icon"></i>'),
             dropDownMenu = $('<div class="menu"/>').append(
                 $('<div class="item"/>')
             )
        );

        v.update = function() {
            if (viewing === v) {
                dropDownIcon.show();
                v.start();
            } else if (viewing!==undefined) {
                dropDownIcon.hide();
                v.stop();
            }
        };

        x.dropdown({

        });

        x.click(function() {
            if (viewing !== v) {
                var prev = viewing;

                //enable drop-down
                viewing = v;

                if (prev) {
                    prev.update();
                }

                $('#view').empty();

                v.update();

            } else {
                //drop-down
            }
        });

        v.update();

        $('#mainButtons').append( x );


        return v;
    }

    function TaskBar(target, menu) {


        // taskbar has to be created first
        var tasks = target;

        var o = {
            windowsContainment: "viewport",
            horizontalStick: "top right",
            draggable: true,
            buttons: { },
            buttonsOrder: [ ]
//            buttons: {
//                log: {
//                    label: "Log",
//                },
//                timeline: {
//                    Label: "Timeline"
//                }
//            },
//
//            buttonsOrder: [ "log", 'timeline' ]

        };

        tasks.taskbar(o);

        /** creates a new taskbar-managed window */
        tasks.newWindow = function(title, contentBuilder, onClose, onResized) {
            return contentBuilder().window({
                taskbar: this,
                title: title,
                close: onClose,
                resizeStop: onResized
            });
        };


        //setup main menus


        _.each(menu, function(m, k) {
            var menuitem = $('#' + k);
            if (menuitem.length === 0)
                console.error('menu item not found', k);

            menuitem.click(function() {
                m.onClick(tasks);
            });
        });


        return tasks;

    }


    $(document).ready(function() {

        terminal = NARTerminal();

        //TaskDB(DB(), terminal);



        addView({
            id: 'graph',
            icon: 'bomb',
            color: 'yellow',
            start: function() {
                $('#view').append(this.graph = SocketNARGraph("active"));
            },
            stop: function() {
                this.graph.stop();
            }
        });
        addView({
            id: 'status',
            icon: 'options',
            color: 'green',
            start: function() {
                $('#view').append(SocketMetaWidget("emotion"));
            },
            stop: function() {

            }
        });
        /*
         <option>Graph</option>
         <option>Tasks</option>
         <option>Terminal</option>
         <option>Status</option>
         <option>News</option>
         <option>Map</option>
         <option>Social</option>
         <option>Web Browser</option>
        */

        var taskbar = TaskBar($( ".taskbar" ), {
            'log': {
                onClick: function(taskbar) {
                    var c = NARConsole(terminal);

                    taskbar.newWindow("Log",
                            function() {
                                return c;
                            },
                            function (event) {
                                console.log('close');
                            },
                            function( event, ui ) {
                                c.editor.resize(true); //ace editor needs resized manually when its container has
                            }
                    );
                }
            },
            'timeline': {
                onClick: function(taskbar) {
                    var g = SocketNARGraph("active");

                    taskbar.newWindow("Timeline",
                            function() {
                                return c;
                            },
                            function (event) {
                                console.log('close');
                            },
                            function( event, ui ) {
                                c.editor.resize(true); //ace editor needs resized manually when its container has
                            }
                    );
                }
            }
        });




        /** input line */
        $("body").append(NARInputter(terminal).attr('id', 'nalInput'));





        $('.ui.dropdown').dropdown({

        });
//        $('#rootButton').dropdown({
//           onHide: function(e) {
//               return false;
//           }
//        });

    });

</script>
</html>