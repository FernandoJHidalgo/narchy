<html>
<head>

    <title>NARchy</title>

    <style type="text/css">
        @import url("terminal.css");
        @import url("spacegraph.dark.css");
        @import url("spacegraph.css");
    </style>

    <style>

        #active {
            position: fixed; width: 100%;
        }

        #active {
            height: 100%;
        }


        .NARConsole {
            width: 100% !important;
            height: 100% !important;
        }

        #nalInput {
            position: fixed; bottom: 0; left: 0; width: 100%;
            height: 30px; opacity: 0.8;
            margin: 0;
            border: 0;
        }
        #nalInput .NALEditor {
            font-size: 30px;
        }

        .ui-dialog {
            opacity: 0.8 !important;
        }

    </style>

    <link rel="import" href="init.html">

</head>
<body>



    <div id="active" style="position: fixed; width: 100%; height: 100%"></div>

    <div class="taskbar"></div>

    <div class="demo">
        <div class="description">...</div>
    </div>

    <!--<div class="ui grid">-->

        <!--<div class="four wide column">-->
            <!--<div class="ui segment" style="opacity: 0.2">-->
                <!--<h1>Emotion</h1>-->
                <!--<div id="emotion"></div>-->
            <!--</div>-->
        <!--</div>-->

    <!--</div>-->

    <!--<div id="menu"></div>-->

    <div id="narOutput">
    </div>





</body>



<script src="narchy.js"></script>

<script>
    "use strict";

    var terminal;

    function TaskBar(target, menu) {


        // taskbar has to be created first
        var tasks = target;

        var o = {
            windowsContainment: "viewport",
            horizontalStick: "top left",
            draggable: true,
            buttons: { },
            buttonsOrder: [ ]
//            buttons: {
//                log: {
//                    label: "Log",
//                },
//                timeline: {
//                    Label: "Timeline"
//                }
//            },
//
//            buttonsOrder: [ "log", 'timeline' ]

        };

        _.each(menu, function(m,k) {
            o.buttons[k] = {
                label: m.label
            };
            o.buttonsOrder.push(k);
        });


        tasks.taskbar(o);

        /** creates a new taskbar-managed window */
        tasks.newWindow = function(title, contentBuilder, onClose, onResized) {
            return contentBuilder().window({
                taskbar: this,
                title: title,
                close: onClose,
                resizeStop: onResized
            });
        };


        tasks.button = function(id, onClick) {
            return this.taskbar( "option", "buttons." + id ).$element.on( "click", onClick);
        }

        _.each(menu, function(m, k) {
            tasks.button(k, function() {
                m.onClick(tasks);
            });
        });


        return tasks;

    }


    $(document).ready(function() {

        terminal = NARTerminal();

        //TaskDB(DB(), terminal);

        var taskbar = TaskBar($( ".taskbar" ), {
            'log': {
                label: 'Log',
                onClick: function(taskbar) {
                    var c = NARConsole(terminal);

                    taskbar.newWindow("Log",
                            function() {
                                return c;
                            },
                            function (event) {
                                console.log('close');
                            },
                            function( event, ui ) {
                                c.editor.resize(true); //ace editor needs resized manually when its container has
                            }
                    );
                }
            },
            'timeline': {
                label: 'Timeline',
                onClick: function(taskbar) {
                    var g = SocketNARGraph("active");

                    taskbar.newWindow("Timeline",
                            function() {
                                return c;
                            },
                            function (event) {
                                console.log('close');
                            },
                            function( event, ui ) {
                                c.editor.resize(true); //ace editor needs resized manually when its container has
                            }
                    );
                }
            }
        });

        /** input line */
        $("body").append(NARInputter(terminal).attr('id', 'nalInput'));

        $("#active").append(SocketNARGraph("active"));

        //$("#emotion").append(SocketMetaWidget("emotion"));


    });

</script>
</html>