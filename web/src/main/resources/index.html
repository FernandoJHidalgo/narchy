<html>

<head>

    <title>NARchy</title>

    <style type="text/css">
        @import url("terminal.css");
        @import url("spacegraph.dark.css");
        @import url("spacegraph.css");
    </style>
    <!--<link rel="import" href="init.html">-->
    <script src="lib/jquery/dist/jquery.min.js"></script>

    <script src="lib/lodash/dist/lodash.min.js"></script>

    <script src="lib/lokijs/build/lokijs.min.js"></script>
    <script src="lib/lokijs/build/loki-indexed-adapter.min.js"></script>

    <script src="lib/jquery-ui/jquery-ui.min.js"></script>

    <link href="jquery-ui/base.css" rel="stylesheet">
    <link href="jquery-ui/customtheme.css" rel="stylesheet">

    <script src="lib/cytoscape/dist/cytoscape.js"></script>
    <script src="lib/cytoscape-edgehandles/cytoscape-edgehandles.js"></script>

    <!--<link href="simone/simone.taskbar.css" rel="stylesheet">
    <link href="simone/simone.window.css" rel="stylesheet">
    <script src="simone/simone.taskbar.js"></script>
    <script src="simone/simone.window.js"></script>
    <script src="simone/i18n-simone.min.custom.js"></script>-->

    <script src="cytoscape-spread/cytoscape-spread.js"></script>

    <script src="lib/ace-builds/src-min-noconflict/ace.js" type="text/javascript" charset="utf-8"></script>
    <script src="lib/ace-builds/src-min-noconflict/theme-vibrant_ink.js" type="text/javascript" charset="utf-8"></script>
    <script src="lib/ace-builds/src-min-noconflict/mode-lisp.js" type="text/javascript" charset="utf-8"></script>
    <script src="lib/metawidget/metawidget-core.min.js"></script>
    <script src="spacegraph.js"></script>
    <script src="frame.js"></script>
    <script src="lib/semantic/dist/semantic.min.js"></script>
    <script type="text/javascript" src="socketview.js"></script>
    <link rel="stylesheet" href="lib/semantic/dist/semantic.min.css" />

    <link rel="stylesheet" href="index.css" />



</head>

<body>

    <div id="mainButtons">

    </div>


    <!--<div id="menu" class="ui compact vertical menu" style="position: absolute">

        <div class="item" id="log">+ Log</div>
        <div class="item" id="timeline">+ Timeline</div>
        <div class="item">+ Status</div>
        <hr/>
        <div class="item">Load...</div>
        <div class="item">Save...</div>
        <hr/>
        <div class="item">CPU Limit (slider)</div>
        <div class="item">Memory Limit (slider)</div>
        <hr/>
        <div class="item">Reset</div>
        <div class="item">Shutdown</div>
    </div>-->

    <div id="view" style="position: fixed; width: 100%; height: 100%; padding-top: 36px;"></div>

</body>


<script src="narchy.js"></script>

<script>
    "use strict";

    let viewing = undefined;

    function addView(v) {
        /*
         <div class="ui dropdown icon purple button" id="rootButton">
         <i class="bomb icon"></i>
         <i class="dropdown icon"></i>
         <div class="menu">
         <div class="item">
         <i class="options icon"></i>
         <select id="rootSelect">

         </select>

         <div id="rootOptions" class="ui segment">
         options..
         <!-- updated by change in rootSelect selector -->
         </div>

         <button class="right floated primary ui button" onclick="$('#rootButton .menu').hide()">OK</button>
         </div>
         </div>
         </div>
         */

        let dropDownIcon;

        //button
        const b = $('<div class="ui icon ' + v.color + ' button"/>').append(
            '<i class="' + v.icon + ' icon"></i>',
            dropDownIcon = $('<i class="dropdown icon"></i>')
        ).attr('title', v.id);

        const ddMenu = $('<div class="mainPopup item"/>');
        ddMenu.hide().appendTo(b).append(v.menu());


        if (!v.start) {
            b.addClass('active');
        }

        v.update = function() {
            if (viewing === v) {
                b.addClass('active');

                dropDownIcon.show();

                setTimeout(v.start, 0);
            } else {

                if (v.start || v.stop) {
                    b.removeClass('active');
                    dropDownIcon.hide();
                    ddMenu.hide();
                }

                if (v.stop) {
                    if (viewing !== undefined) {
                        setTimeout(v.stop, 0);
                    }
                }
            }
        };


        function enable() {
            if (viewing !== v) {
                const prev = viewing;

                //enable drop-down
                viewing = v;

                if (prev) {
                    prev.update();
                }

                $('#view').empty();

                v.update();

                return true;
            }
            return false;
        }

        function toggle() {
            ddMenu.toggle(0);
        }

        b.click(function() {
            if (v.start) {
                if (viewing !== v) {
                    enable();
                } else {
                    toggle();
                }
            } else {
                toggle();
            }
        });
        b.dblclick(function() {
            if (enable())
                toggle();
        });

        v.update();

        $('#mainButtons').append(b);

        v.click = b.click;

        return v;
    }



    $(document).ready(function() {


        /* Deprecated: */
        var globalTerminal = NARTerminal();

        //TaskDB(DB(), terminal);

        addView({
            id: 'main',
            icon: 'warning',
            color: 'orange',
            menu: function() {
                return $('#menu');
            },
            start: function() {
                this.terminal = globalTerminal;//NARTerminal();
                $('#view').append(new NARConsole(this.terminal));
            },
            stop: function() {
                try {
                    this.terminal.close();
                } catch (e) {
                    console.log(e);
                }
                this.terminal = undefined;
            }
        }).start( /* default  */ );

        addView({
            id: 'graph',
            icon: 'bomb',
            color: 'yellow',
            start: function() {
                $('#view').append(this.graph = SocketNARGraph("active"));
            },
            menu: function() {
                return 'abc';
            },
            stop: function() {
                this.graph.stop();
                this.graph = undefined;
            }
        });
        addView({
            id: 'status',
            icon: 'options',
            color: 'green',
            start: function() {
                $('#view').append(SocketMetaWidget("emotion"));
            },
            menu: function() {
                return 'abc';
            },
            stop: function() {

            }
        });
        addView({
            id: 'top',
            icon: 'options',
            color: 'blue',
            start: function() {
                $('#view').append(TopTable("active"));
            },
            menu: function() {
                return 'abc';
            },
            stop: function() {

            }
        });


        /*
         <option>Graph</option>
         <option>Tasks</option>
         <option>Terminal</option>
         <option>Status/InterNARs</option>
         <option>News</option>
         <option>Map</option>
         <option>Social</option>
         <option>Web Browser</option>
         */




        /** input line */
        $("#mainButtons").append(NARInputter(globalTerminal).attr('id', 'nalInput'));




    });
</script>

</html>
