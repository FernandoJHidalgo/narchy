<html>
<head>
    <title></title>
    <script src="lib/labjs/LAB.min.js"></script>
    <style>
        #in {
            position: fixed;
            width: 100%;
            height: 4em;
            bottom: 0;
        }

        .task {
            overflow-x: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            word-break: break-all;
            word-wrap: break-word;
        }

        .task:hover {
            background-color: #151515;
        }


        #input {
            width: 75%;
            float: left;
        }

        #out .terminal {
            max-height: 90%;
        }

        .task .exp {
            padding-left: 4em; /*indent*/
            margin-bottom: 1em;
            word-wrap: normal;
            max-width: 100%;
            overflow-x: auto;
            word-spacing: normal;
            white-space: normal;
            word-break: break-all;
        }
    </style>
</head>

<body>
    <div id="in">
        <div id="options">
            <button class="cmd start">start</button>
            <button class="cmd stop">stop</button>
            <button class="cmd clear">clear</button>
            <button class="cmd top">top</button>
            <button class="cmd stat">stat</button>
            <select>
                <option>*</option>
                <option>mode 1</option>
                <option>mode 2</option>
                <option>sleep</option>
            </select>
        </div>
    </div>
    <div id="out"></div>
</body>

<script>

    $LAB
        .script("lib/lodash/dist/lodash.min.js")
        .script("lib/jquery/dist/jquery.min.js")
        .script("lib/fastdom/fastdom.min.js")
        .script("lib/jquery-ui/jquery-ui.min.js")
        .script("lib/jsoneditor/dist/jsoneditor-minimalist.min.js")
        .script("lib/cytoscape/dist/cytoscape.js")
        .script("lib/codemirror/lib/codemirror.js")
        .script("lib/codemirror/mode/clojure/clojure.js")
        .script("EventEmitter.js")
        .script("ReconnectingWebsocket.js")
        .script("spacegraph.js")
        .script("narchy.js")
        .script("menu.js")
        .wait(function() {


             //$('body').append( graphConcepts($('body')) );


             var s = null; //HACK
             s = NARSocket('terminal', decodeTasks, {
                onopen: () => {

                    $('#in').prepend( NALInputEditor(s).attr('id', 'input') );
                    $('#out').append( taskFeed(s) );

                    //command widget actions
                    $('.cmd').each((k,x) => {

                        var cc = $(x).attr('class');
                        if (cc && cc.startsWith('cmd '))
                            cc = cc.substr(4);

                        cc += '()';

                        $(x).click( () => {
                            s.send( cc );
                        });
                    });

                    //return dock(s, $('body'));
                }
            });

        });

</script>

<style type="text/css">

    @import url("spacegraph.dark.css");
    @import url("spacegraph.css");
    @import url("lib/golden-layout/src/css/goldenlayout-base.css");
    @import url("index.goldenlayout.css");
    @import url("index.jsoneditor.css");
    @import url("lib/codemirror/lib/codemirror.css");
    @import url("lib/codemirror/theme/night.css");
    @import url("index.css");

</style>